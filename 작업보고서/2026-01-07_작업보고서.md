# 작업보고서

**날짜:** 2026-01-07

## 작업 내용

### 1. ESP32-CAM USB 연결 확인
- USB 케이블 교체 후 CH340 시리얼 변환기 인식 확인
- 시리얼 포트: `/dev/ttyUSB0`

### 2. 폴더 구조 정리
- `today` 폴더 생성
- `esp-camera` 폴더를 `today` 폴더로 이동

### 3. CameraTest 프로그램 업로드 및 테스트
- `/home/uttec/today/esp32Camera/CameraTest/CameraTest.ino` 컴파일 및 업로드
- arduino-cli 사용: `esp32:esp32:esp32cam` FQBN
- 업로드 성공 확인

### 4. ESP32-CAM-MB 보드 부트 모드 문제 해결
- **문제:** Raspberry Pi에서 시리얼 읽기 시 `boot:0x12` (다운로드 모드)로 계속 부팅
- **원인:** ESP32-CAM-MB 보드의 자동 리셋 회로가 DTR/RTS 신호에 반응
- **해결:**
  - BOOT 버튼 없이 RST 버튼만 눌러 정상 부팅 (`boot:0x13`)
  - 시리얼 읽기 시 Python pyserial 사용 (DTR/RTS 비활성화)

### 5. Windows Arduino IDE 테스트 성공
- Arduino IDE 2.3.7에서 테스트
- 보드 선택: **AI Thinker ESP32-CAM**
- Serial Monitor에서 정상 출력 확인:
  ```
  ========================================
     ESP32-CAM Camera Test
  ========================================
  [INFO] PSRAM found - High resolution enabled
  [OK] Camera initialized successfully!
  [INFO] Camera PID: 0x26
  [CAPTURE #1] Size: 67780 bytes, Resolution: 1600x1200, Format: JPEG
  ```

### 6. Raspberry Pi에서 시리얼 출력 읽기 성공
- **방법:** Python pyserial 사용 (DTR/RTS 비활성화)
- **코드:**
  ```python
  import serial
  ser = serial.Serial()
  ser.port = '/dev/ttyUSB0'
  ser.baudrate = 115200
  ser.dtr = False
  ser.rts = False
  ser.open()
  ```
- cat 명령어 대신 pyserial 사용 필요 (MB 보드 자동 리셋 방지)

### 7. README.md 설명서 작성
- 2개 프로그램 (CameraTest, Web Streaming Server) 설명서 작성
- 파일 위치: `/home/uttec/today/esp32Camera/README.md`
- 내용: 기능 설명, 사용 방법, 업로드 순서, 문제 해결 가이드

### 8. util 폴더 및 시리얼 모니터 스크립트 생성
- `util/serial_monitor.py` 생성
- DTR/RTS 비활성화로 ESP32-CAM-MB 자동 리셋 방지
- 사용법:
  ```bash
  python3 util/serial_monitor.py /dev/ttyUSB0 115200
  ```

### 9. Web Streaming Server 업로드 및 테스트
- WiFi 설정: SSID `ihong`, Password 설정
- `WebStreamingServer/WebStreamingServer.ino` 생성 및 업로드
- **문제 발견:** 메인 페이지에서 스트림이 안 보임
  - 원인: 스트림은 포트 81, HTML은 포트 80의 `/stream` 참조
  - 해결: JavaScript로 포트 81 URL 동적 설정
  ```javascript
  var streamUrl = 'http://' + window.location.hostname + ':81/stream';
  ```
- 웹 서버 정상 동작 확인:
  - 메인 페이지: `http://192.168.0.32`
  - 스트림: `http://192.168.0.32:81/stream`
  - 캡처: `http://192.168.0.32/capture`
  - 플래시: `http://192.168.0.32/flash`

### 10. 스마트폰 카메라 가이드 문서 작성
- 파일 위치: `/home/uttec/today/esp32Camera/docs/smartphone_camera_guide.md`
- 목적: 스마트폰 카메라를 Raspberry Pi에서 번호판 인식용으로 활용
- 포함 내용:
  - **IP Webcam (WiFi)**: 가장 간단한 방법
  - **scrcpy + USB**: 가장 낮은 지연시간 (번호판 인식 추천)
  - **DroidCam**: WiFi/USB 모두 지원
  - **ADB 포워딩**: 직접 제어
  - Python/OpenCV 연동 코드
  - 번호판 인식 예시 코드 (EasyOCR, YOLOv8)

## 확인된 하드웨어 정보

| 항목 | 값 |
|------|-----|
| 보드 | ESP32-CAM + ESP32-CAM-MB |
| 칩 | ESP32-D0WD-V3 (revision v3.1) |
| MAC | fc:b4:67:4e:8f:dc |
| 카메라 센서 | OV2640 (PID: 0x26) |
| PSRAM | 있음 (고해상도 지원) |
| 해상도 | 1600x1200 (UXGA) |

## 다음 작업

- 스마트폰 카메라 (IP Webcam 또는 scrcpy) 연동 테스트
- 번호판 인식 시스템 구현 (OpenCV + EasyOCR)
- ESP32-CAM vs 스마트폰 카메라 성능 비교

## 참고 사항

### ESP32-CAM-MB 사용 시 주의점
1. **업로드:** BOOT 누른 상태 → RST 눌렀다 떼기 → BOOT 떼기 → 업로드
2. **실행:** BOOT 누르지 않고 RST만 누르기
3. **Raspberry Pi 시리얼 읽기:** `cat` 대신 Python pyserial 사용 (DTR=False, RTS=False)

### 시리얼 모니터 설정
- Baud Rate: 115200
- Flow Control: None (중요!)
